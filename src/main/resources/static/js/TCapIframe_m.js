!function(t){function e(t,e,i){if(t.indexOf("?")!=-1){var n=new RegExp("(\\?|&"+e+")=[^&]*");t=n.test(t)?t.replace(n,"$1="+i):t+"&"+e+"="+i}else t=t+"?"+e+"="+i;return t}function i(t,i){for(var n in i)t=e(t,encodeURIComponent(n),encodeURIComponent(i[n]));return t}function n(){return r||(r=this.init.apply(this,arguments))}function s(){return"number"==typeof window.orientation&&"object"==typeof window.onorientationchange&&(window.orientation==-90||90==window.orientation)||window.innerHeight<window.innerWidth}function o(t,e,i){t=parseInt(t,10),e=parseInt(e,10);var n=w["default"].width,o=w["default"].height;"inner"==i.opts.curenv?(0==t&&(n=w["char"].width,o=w["char"].height),1==t&&1==e&&(n=w.click.width,o=w.click.height),1==t&&4==e&&(n=w.click.width,o=w.click.height),1==t&&7==e&&(n=w.click.width,o=w.click.height),1==t&&8==e&&(n=w.slide.width,o=w.slide.height),1==t&&9==e&&(n=w.slidepuzzle.width,o=w.slidepuzzle.height)):(1==t&&(n=w["char"].width,o=w["char"].height),2==t&&1==e&&(n=w.click.width,o=w.click.height),2==t&&4==e&&(n=w.click.width,o=w.click.height),2==t&&7==e&&(n=w.click.width,o=w.click.height),2==t&&8==e&&(n=w.slide.width,o=w.slide.height),2==t&&9==e&&(n=w.slidepuzzle.width,o=w.slidepuzzle.height));var r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,h=Math.min(r/u),d=Math.min(c/u);if(s()){d=.85*d,d=d>1.5?1.5:d,d=d<.85?.85:d;var a=parseInt(1e4*d)/1e4;n=n*a*16+3,o=o*a*16+3}else{h=h>1.5?1.5:h,h=h<.85?.85:h;var a=parseInt(1e4*h)/1e4;n=n*a*16+3,o=o*a*16+3}i.sizeSC.width=parseInt(n),i.sizeSC.height=parseInt(o),c-o<0?i.posSC.top="0px":i.posSC.top=(c-o)/2+"px",i.posSC.left=(r-n)/2+"px"}var r,c={securityCode:"securityCode"},h=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,!1)[e]},d=function(t){return function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}},u=320,a=d("Object"),l=d("Function"),p=function(t,e){if(t&&e){if(a(e)){for(var i in e)t.style[i]=e[i];return e}return h(t,e)}},f=function(t,e,i){i=i||!1;var n={};for(var s in e)t[s]=e[s];if(i){for(var s in t)n[s]=t[s];return n}return t},w={"char":{width:18.6,height:13.6},click:{width:18.2,height:19.6},slide:{width:18.2,height:18.1},slidepuzzle:{width:18.2,height:16.1},"default":{width:"100%",height:"100%"}},g=0,m=10,y={top:"0%",left:"0%"},C={ele:document.body,src:"",uid:"",capcd:"",startFn:function(){},endFn:function(){}},S=function(t){var e=window.document.getElementsByTagName("script")[0],n=window.document.createElement("script"),s=t.callback||"callback",o="_aq_"+Math.floor(1e6*Math.random()),r=window[o]=t.success||function(){},c=t.url,h={};h[s]=o,t.data&&(h=f(h,t.data)),c=i(c,h),n.async=t.async||!0,n.src=c,n.onload=function(){n&&e.parentNode&&e.parentNode.removeChild(n),r=null},e.parentNode.insertBefore(n,e)};n.prototype={init:function(t){return this.opts=f(C,t||{}),this.initOptions(),this.listenFunc=[],this.msg=new TCapMsg("parent"),this.initListener(),this.windowHeight=0,this.windowWidth=0,this},initOptions:function(){this.ele=this.opts.ele?this.opts.ele==document?document.body:this.opts.ele:document.body,this.opts.type&&"popup"==this.opts.type&&(this.ele=document.body),this.src=this.opts.domain+"/"+this.opts.cgi+this.opts.params,this.ticket="",this.randstr="",null==this.sizeSC&&(this.sizeSC=f({},w["default"])),null==this.posSC&&(this.posSC=f({},y)),this.securityIframe="",this.startY=0,this.moveY=0},initListener:function(){var t=this;this.msg.listen(function(e){try{e=JSON.parse(e)}catch(i){return}if(e&&e.message&&e.message.type){e=e.message;var n=e.type;switch(n){case 3:if(e&&e.ticket){t.ticket=e.ticket,t.randstr=e.randstr;for(var s=0,o=t.listenFunc.length;s<o;s++)t.closeSecurityCode(function(){t.listenFunc[s]({ret:0,ticket:e.ticket,randstr:e.randstr})});t.listenFunc.length||t.closeSecurityCode()}return;case 4:for(var s=0,o=t.listenFunc.length;s<o;s++)t.closeSecurityCode(function(){t.listenFunc[s]({ret:1,ticket:"",randstr:""})});return void(t.listenFunc.length||t.closeSecurityCode());case 6:for(var s=0,o=t.listenFunc.length;s<o;s++)t.closeSecurityCode(function(){t.listenFunc[s]({ret:2,ticket:"",randstr:""})});return void(t.listenFunc.length||t.closeSecurityCode());case 7:return void p(t.securityIframe,{border:"1px solid #e8e8e8",background:"#ffffff","border-radius":"3px",opacity:"1"})}}})},initPos:function(t){t&&t.top&&(this.posSC.top=t.top),t&&t.left&&(this.posSC.left=t.left)},create:function(){if("popup"==this.opts.type){var t,e,i=this,n=this.opts.gettype;S({url:n,success:function(n){t=n.capclass,e=n.subcapclass,setTimeout(function(){o(n.capclass,n.subcapclass,i),i.src=i.opts.domain+"/"+n.src+i.opts.params+"&sess="+n.sess,i.createSecurityCode(),g=window.innerWidth,window.onresize=function(){setTimeout(function(){if(!(Math.abs(window.innerWidth-g)<m)){g=window.innerWidth,o(t,e,i);var n={height:i.sizeSC.height+"px",width:i.sizeSC.width+"px",top:i.posSC.top,left:i.posSC.left};p(i.securityIframe,n),i.send2securityCode(JSON.stringify({message:{type:1,width:i.sizeSC.width,height:i.sizeSC.height}}))}},200)}},350)}})}else{var i=this;setTimeout(function(){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;i.sizeSC.height=t,i.sizeSC.width=e,i.windowHeight=t,i.windowWidth=e,i.createSecurityCode(),window.onresize=function(){setTimeout(function(){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(!(Math.abs(i.windowWidth-e)<30)){i.sizeSC.height=t,i.sizeSC.width=e,i.windowHeight=t,i.windowWidth=e;var n={height:i.sizeSC.height+"px",width:i.sizeSC.width+"px"};p(i.securityIframe,n),i.send2securityCode(JSON.stringify({message:{type:1,width:i.sizeSC.width,height:i.sizeSC.height}}))}},200)}},350)}},createSecurityCode:function(){this.opts.startFn();var t={uid:this.opts.uid,cap_cd:this.opts.capcd,rnd:Math.floor(1e6*Math.random())};if(this.hasSecurityCode()){var e={height:this.sizeSC.height+"px",width:this.sizeSC.width+"px",top:this.posSC.top,left:this.posSC.left};return p(this.securityIframe,e),void(this.securityIframe.src=i(this.src,t))}var n=document.createElement("iframe");n.setAttribute("frameborder","0",0),n.setAttribute("border","0"),n.marginheight=0,n.marginwidth=0,n.setAttribute("marginheight","0",0),n.setAttribute("marginwidth","0",0);var s="absolute";"popup"==this.opts.type?(s="absolute",n.setAttribute("scrolling","no"),p(n,{opacity:"0"})):p(n,{border:"0px"});var e={height:this.sizeSC.height+"px",width:this.sizeSC.width+"px",top:this.posSC.top,left:this.posSC.left,position:s,margin:"auto","z-index":999};p(n,e),this.securityIframe=n,this.ele.appendChild(n),this.src=i(this.src,t),n.src=this.src,this.initSecurityCodeTarget()},hasSecurityCode:function(){var t=!!this.securityIframe&&this.securityIframe;return t},initSecurityCodeTarget:function(){this.msg.addTarget(this.securityIframe.contentWindow,c.securityCode)},destroy:function(){r&&(this.closeSecurityCode(),this.listenFunc=[],this.msg.clear(),this.ele="",r="")},refresh:function(t){r&&(this.closeSecurityCode(),this.initOptions(),a(t)&&(t.uin&&(this.opts.uid=t.uin),t.uid&&(this.opts.uid=t.uid),t.capcd&&(this.opts.capcd=t.capcd)),this.createSecurityCode())},listen:function(t){this.listenFunc=[],this.listenFunc.push(t)},send2securityCode:function(t){var e=c.securityCode;this.msg.targets[e].send(t)},closeSecurityCode:function(t){this.opts.endFn(),this.securityIframe&&(this.securityIframe.parentNode&&this.securityIframe.parentNode.removeChild(this.securityIframe),this.securityIframe=""),l(t)&&t(),window.CollectGarbage&&window.CollectGarbage()},clear:function(){this.listenFunc.length=0},getTicket:function(){return{ticket:this.ticket,randstr:this.randstr}},start:function(t){this.opts.startFn=t},end:function(t){this.opts.endFn=t}},t.AqSCode=n}(window);